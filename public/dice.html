<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Dice - Dynatrace Observatory</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dt-purple': '#6C2C9C',
                        'dt-blue': '#00A1C9',
                        'dt-cyan': '#00D4FF',
                        'dt-green': '#73BE28',
                        'dt-orange': '#FFA86B',
                        'dt-yellow': '#FFD23F',
                        'dt-dark': '#151515',
                        'dt-darker': '#0A0A0A',
                        'dt-gray': '#2D2D2D',
                        'dt-light-gray': '#4A4A4A'
                    }
                }
            }
        }
    </script>
    
    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Smartscape-inspired background matching lobby */
        .dice-bg {
            background: 
                radial-gradient(circle at 10% 20%, rgba(108, 44, 156, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(115, 190, 40, 0.05) 0%, transparent 60%),
                linear-gradient(135deg, #0A0A0A 0%, #151515 100%);
        }
        
        .dice-table {
            background: 
                radial-gradient(circle at 30% 30%, rgba(108, 44, 156, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 70% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                linear-gradient(145deg, rgba(21, 21, 21, 0.95), rgba(45, 45, 45, 0.8));
            border: 4px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 0 0 2px #6C2C9C,
                0 20px 60px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(108, 44, 156, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .dice-table::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(218, 165, 32, 0.06) 0%, transparent 35%);
            pointer-events: none;
        }
        
        .dice {
            width: 100px;
            height: 100px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 0 auto;
        }
        
        .dice-cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(0deg) rotateY(0deg);
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .dice-face {
            position: absolute;
            width: 100px;
            height: 100px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 3px solid #6c757d;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 8px;
            box-sizing: border-box;
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.4),
                inset 0 3px 6px rgba(255, 255, 255, 0.9),
                inset 0 -3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dice-face.front { transform: rotateY(0deg) translateZ(50px); }
        .dice-face.back { transform: rotateY(180deg) translateZ(50px); }
        .dice-face.right { transform: rotateY(90deg) translateZ(50px); }
        .dice-face.left { transform: rotateY(-90deg) translateZ(50px); }
        .dice-face.top { transform: rotateX(90deg) translateZ(50px); }
        .dice-face.bottom { transform: rotateX(-90deg) translateZ(50px); }
        
        .dice.rolling .dice-cube {
            animation: dice-roll-3d 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .dice.rolling {
            transform: scale(1.05);
            filter: drop-shadow(0 20px 40px rgba(108, 44, 156, 0.4));
        }
        
        @keyframes dice-roll-3d {
            0% { 
                transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
            }
            25% { 
                transform: rotateX(180deg) rotateY(90deg) rotateZ(45deg) scale(1.1);
            }
            50% { 
                transform: rotateX(360deg) rotateY(180deg) rotateZ(90deg) scale(1.15);
            }
            75% { 
                transform: rotateX(540deg) rotateY(270deg) rotateZ(135deg) scale(1.1);
            }
            100% { 
                transform: rotateX(720deg) rotateY(360deg) rotateZ(180deg) scale(1);
            }
        }
        
        @keyframes dice-hover {
            0%, 100% { transform: translateY(0px) rotateY(0deg); }
            50% { transform: translateY(-10px) rotateY(5deg); }
        }
        
        .dice:hover .dice-cube {
            animation: dice-hover 2s ease-in-out infinite;
            transform: rotateY(15deg) rotateX(-10deg);
        }
        
        @keyframes ambient-glow {
            0%, 100% { 
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4), 
                           inset 0 3px 6px rgba(255, 255, 255, 0.9),
                           0 0 20px rgba(102, 126, 234, 0.3);
            }
            50% { 
                box-shadow: 0 16px 32px rgba(0, 0, 0, 0.5), 
                           inset 0 3px 6px rgba(255, 255, 255, 0.9),
                           0 0 30px rgba(118, 75, 162, 0.4);
            }
        }
        
        .dice-face {
            animation: ambient-glow 4s ease-in-out infinite;
        }
        
        .dice-dot {
            width: 16px;
            height: 16px;
            background: radial-gradient(circle at 30% 30%, #1a1a1a, #333, #000);
            border-radius: 50%;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.6),
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                inset 0 -1px 2px rgba(0, 0, 0, 0.4);
            position: relative;
        }
        
        .dice-dot::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.6);
        }
        
        /* 3D Cube Face Patterns */
        .face-1 { justify-content: center; align-items: center; }
        .face-1 .dice-dot { margin: 0; }
        
        .face-2 { justify-content: space-between; align-items: stretch; flex-direction: column; }
        .face-2 .dice-dot:nth-child(1) { align-self: flex-start; }
        .face-2 .dice-dot:nth-child(2) { align-self: flex-end; }
        
        .face-3 { justify-content: space-between; align-items: stretch; flex-direction: column; }
        .face-3 .dice-dot:nth-child(1) { align-self: flex-start; }
        .face-3 .dice-dot:nth-child(2) { align-self: center; margin: auto; }
        .face-3 .dice-dot:nth-child(3) { align-self: flex-end; }
        
        .face-4 { 
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            align-items: center;
            justify-items: center;
        }
        
        .face-5 { 
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 8px;
            padding: 16px;
            align-items: center;
            justify-items: center;
        }
        .face-5 .dice-dot:nth-child(1) { grid-column: 1; grid-row: 1; }
        .face-5 .dice-dot:nth-child(2) { grid-column: 3; grid-row: 1; }
        .face-5 .dice-dot:nth-child(3) { grid-column: 2; grid-row: 2; }
        .face-5 .dice-dot:nth-child(4) { grid-column: 1; grid-row: 3; }
        .face-5 .dice-dot:nth-child(5) { grid-column: 3; grid-row: 3; }
        
        .face-6 { justify-content: space-between; align-content: space-between; flex-direction: column; }
        .face-6-row { display: flex; justify-content: space-between; width: 100%; }
        .face-6 .dice-dot { margin: 2px; }
        
        .bet-area {
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.15) 0%, transparent 40%),
                linear-gradient(180deg, #2D2D2D 0%, #1A1A1A 30%, #2D2D2D 70%, #1A1A1A 100%);
            border: 3px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 0 0 2px #8B4513,
                inset 0 4px 15px rgba(0, 0, 0, 0.9),
                inset 0 -4px 15px rgba(139, 69, 19, 0.3),
                0 8px 25px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(139, 69, 19, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .bet-area:hover {
            border-color: #FFA86B;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 168, 107, 0.2) 0%, transparent 40%),
                linear-gradient(180deg, #2D2D2D 0%, #1A1A1A 30%, #2D2D2D 70%, #1A1A1A 100%);
            box-shadow: 
                0 0 0 2px #FFA86B,
                0 0 30px rgba(255, 168, 107, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .bet-area.selected {
            border-color: #FFD23F;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 210, 63, 0.2) 0%, transparent 40%),
                linear-gradient(180deg, #2D2D2D 0%, #1A1A1A 30%, #2D2D2D 70%, #1A1A1A 100%);
            box-shadow: 
                0 0 0 2px #FFD23F,
                0 0 30px rgba(255, 210, 63, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .probability-chart {
            background: 
                radial-gradient(circle at 30% 30%, rgba(108, 44, 156, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 70% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                linear-gradient(145deg, rgba(21, 21, 21, 0.95), rgba(45, 45, 45, 0.9));
            border: 2px solid transparent;
            background-clip: padding-box;
            backdrop-filter: blur(15px);
            box-shadow: 
                0 0 0 1px rgba(108, 44, 156, 0.3),
                0 8px 25px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(108, 44, 156, 0.2);
        }
        
        .sum-indicator {
            transition: all 0.5s ease;
            transform: scale(1);
        }
        
        .sum-indicator.highlight {
            transform: scale(1.2);
            background: linear-gradient(145deg, #FFD23F, #FFA86B) !important;
            box-shadow: 0 0 20px rgba(255, 210, 63, 0.8);
        }
        
        /* Side Panel Styles */
        .side-panel {
            background: 
                radial-gradient(circle at 20% 30%, rgba(108, 44, 156, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.1) 0%, transparent 40%),
                linear-gradient(145deg, rgba(21, 21, 21, 0.98), rgba(45, 45, 45, 0.95));
            backdrop-filter: blur(20px);
            box-shadow: 
                2px 0 20px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(108, 44, 156, 0.3),
                inset -1px 0 0 rgba(0, 212, 255, 0.2);
        }
        
        .side-panel-open {
            transform: translateX(0) !important;
        }
        
        .main-content-shifted {
            margin-left: 320px;
        }
        
        .config-toggle-btn {
            background: 
                radial-gradient(circle at 25% 25%, rgba(108, 44, 156, 0.9) 0%, rgba(75, 31, 111, 0.9) 70%),
                linear-gradient(145deg, rgba(108, 44, 156, 0.8), rgba(45, 45, 45, 0.6));
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.7),
                0 0 20px rgba(108, 44, 156, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        
        .config-toggle-btn:hover {
            background: 
                radial-gradient(circle at 25% 25%, rgba(108, 44, 156, 1) 0%, rgba(75, 31, 111, 1) 70%),
                linear-gradient(145deg, rgba(108, 44, 156, 0.9), rgba(45, 45, 45, 0.7));
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(108, 44, 156, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .metric-value {
            background: linear-gradient(45deg, #00D4FF, #6C2C9C, #73BE28);
            background-size: 300% 300%;
            animation: metric-shimmer 3s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes metric-shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* Responsive Layout System */
        .responsive-layout {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .responsive-header {
            height: clamp(60px, 8vh, 80px);
            flex-shrink: 0;
        }
        
        .responsive-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }
        
        .game-grid {
            height: 100%;
            display: grid;
            grid-template-rows: 1fr auto;
            grid-template-columns: 1fr;
            overflow: hidden;
            position: relative;
        }
        
        /* Side Analytics Panel */
        .side-analytics {
            position: absolute;
            top: 2rem;
            right: 2rem;
            width: 280px;
            z-index: 10;
            pointer-events: auto;
        }
        
        .metrics-panel {
            background: 
                linear-gradient(135deg, rgba(17, 17, 19, 0.95) 0%, rgba(29, 29, 35, 0.95) 100%),
                linear-gradient(45deg, rgba(108, 44, 156, 0.1) 0%, rgba(0, 212, 255, 0.1) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(108, 44, 156, 0.3);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(108, 44, 156, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .metric-value {
            color: #00d4ff;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
        }
        
        /* Main Game Area */
        .main-game-area {
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
    </style>
</head>
<body class="responsive-layout dice-bg text-white font-sans">
    
    <!-- Header -->
    <header class="responsive-header bg-dt-dark/90 backdrop-blur-md border-b border-dt-cyan/20">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 ml-16">
                    <button onclick="window.location.href='lobby.html'" class="bg-dt-gray hover:bg-dt-light-gray text-white px-4 py-2 rounded-lg font-semibold text-sm">
                        ‚Üê Lobby
                    </button>
                    <div>
                        <h1 class="text-xl font-bold text-dt-cyan">üé≤ Process Dice</h1>
                        <p class="text-xs text-dt-light-gray">Dynatrace Observatory</p>
                    </div>
                </div>
                
                <!-- User info and balance -->
                <div class="flex items-center space-x-4">
                    <div class="bg-dt-dark/60 border border-dt-cyan/20 rounded-lg px-4 py-2">
                        <div class="flex items-center space-x-4 text-sm">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-dt-green rounded-full animate-pulse"></div>
                                <span class="text-dt-cyan">Agent:</span>
                                <span id="agentName" class="font-mono text-white">Loading...</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-dt-cyan">Balance:</span>
                                <span id="balanceDisplay" class="font-mono text-dt-yellow font-semibold">$0</span>
                            </div>
                            <button onclick="addFunds()" class="bg-dt-green hover:bg-dt-green/80 text-white px-3 py-1 rounded text-xs font-semibold transition-colors">
                                Deposit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Collapsible Side Panel for Cheat Configuration -->
    <div id="cheatSidePanel" class="fixed left-0 top-0 h-full w-80 side-panel transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
        <div class="p-6 h-full overflow-y-auto">
            <!-- Panel Header -->
            <div class="flex items-center justify-between mb-6 pb-4 border-b border-dt-light-gray/20">
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 bg-dt-purple rounded-full animate-pulse"></div>
                    <h3 class="text-lg font-bold text-dt-cyan">‚öôÔ∏è Configuration Lab</h3>
                </div>
                <button id="closeSidePanel" onclick="toggleCheatSidePanel()" class="text-dt-light-gray hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Configuration Content -->
            <div class="space-y-6">
                <!-- Demo Methods Section -->
                <div class="bg-dt-darker/60 rounded-lg p-4 border border-dt-purple/30">
                    <div class="text-center mb-4">
                        <h4 class="text-dt-purple font-bold text-md mb-1">Demo Enhancement Methods</h4>
                        <div class="text-xs text-gray-400">Laboratory environment - All methods unlocked</div>
                        <div class="text-xs text-dt-green mt-1 bg-green-900/30 px-2 py-1 rounded">‚úì Free Testing Mode</div>
                    </div>
                    
                    <div class="space-y-3">
                        <button id="cheatDiceWeighting" class="w-full cheat-button bg-green-900/30 hover:bg-green-800/50 border border-green-500/50 text-green-300 px-4 py-3 rounded-lg text-sm font-semibold transition-all text-left" onclick="activateCheat('diceWeighting')">
                            <div class="flex items-center justify-between mb-1">
                                <span class="flex items-center space-x-2">
                                    <span>ÔøΩ</span>
                                    <span>Weighted Dice Control</span>
                                </span>
                                <span class="text-xs text-green-400 bg-green-900/50 px-2 py-1 rounded">FREE</span>
                            </div>
                            <div class="text-xs text-green-400/70 ml-6">Influence dice roll outcomes with weighted mechanics (+40% win rate)</div>
                        </button>
                        
                        <button id="cheatRollPrediction" class="w-full cheat-button bg-green-900/30 hover:bg-green-800/50 border border-green-500/50 text-green-300 px-4 py-3 rounded-lg text-sm font-semibold transition-all text-left" onclick="activateCheat('rollPrediction')">
                            <div class="flex items-center justify-between mb-1">
                                <span class="flex items-center space-x-2">
                                    <span>ÔøΩ</span>
                                    <span>Roll Pattern Analysis</span>
                                </span>
                                <span class="text-xs text-green-400 bg-green-900/50 px-2 py-1 rounded">FREE</span>
                            </div>
                            <div class="text-xs text-green-400/70 ml-6">AI analysis of dice rolling patterns and physics (+35% win rate)</div>
                        </button>
                        
                        <button id="cheatProbabilityManipulation" class="w-full cheat-button bg-green-900/30 hover:bg-green-800/50 border border-green-500/50 text-green-300 px-4 py-3 rounded-lg text-sm font-semibold transition-all text-left" onclick="activateCheat('probabilityManipulation')">
                            <div class="flex items-center justify-between mb-1">
                                <span class="flex items-center space-x-2">
                                    <span>‚ö°</span>
                                    <span>Probability Override</span>
                                </span>
                                <span class="text-xs text-green-400 bg-green-900/50 px-2 py-1 rounded">FREE</span>
                            </div>
                            <div class="text-xs text-green-400/70 ml-6">Override natural probability distributions (+50% win rate)</div>
                        </button>
                        
                        <button id="cheatStreakBooster" class="w-full cheat-button bg-green-900/30 hover:bg-green-800/50 border border-green-500/50 text-green-300 px-4 py-3 rounded-lg text-sm font-semibold transition-all text-left" onclick="activateCheat('streakBooster')">
                            <div class="flex items-center justify-between mb-1">
                                <span class="flex items-center space-x-2">
                                    <span>ÔøΩ</span>
                                    <span>Winning Streak Amplifier</span>
                                </span>
                                <span class="text-xs text-green-400 bg-green-900/50 px-2 py-1 rounded">FREE</span>
                            </div>
                            <div class="text-xs text-green-400/70 ml-6">Amplify and extend winning streak probabilities (+45% win rate)</div>
                        </button>
                        
                        <button onclick="deactivateCheat()" class="w-full bg-red-800/60 hover:bg-red-700/70 border border-red-500/50 text-white text-sm py-3 px-4 rounded-lg transition-all font-semibold">
                            üõë Reset to Baseline Configuration
                        </button>
                    </div>
                    
                    <div id="cheatStatus" class="text-center text-xs text-gray-400 mt-4 pt-4 border-t border-gray-700/50">
                        üî¨ Observatory Mode - Baseline Configuration Active
                    </div>
                </div>
                
                <!-- Status Information -->
                <div class="bg-dt-darker/40 rounded-lg p-4 border border-dt-cyan/20">
                    <h4 class="text-dt-cyan font-semibold text-sm mb-2">üìä Current Session Status</h4>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between">
                            <span class="text-dt-light-gray">Enhancement Active:</span>
                            <span id="sidePanelCheatStatus" class="text-dt-yellow">None</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-dt-light-gray">Performance Boost:</span>
                            <span id="sidePanelBoostLevel" class="text-dt-green">Baseline</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-dt-light-gray">Demo Duration:</span>
                            <span class="text-dt-cyan">30 seconds</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Side Panel Toggle Button -->
    <button id="cheatToggleBtn" onclick="toggleCheatSidePanel()" class="fixed left-4 top-4 config-toggle-btn text-white p-3 rounded-lg shadow-lg transition-all duration-300 z-30">
        <div class="flex flex-col items-center space-y-1">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
            </svg>
            <div class="text-xs font-semibold">Enable Cheats</div>
        </div>
    </button>

    <!-- Main Game Area -->
    <main class="responsive-main transition-all duration-300" id="mainGameArea">
        <div class="game-grid">
            <!-- Side Analytics (Floating) -->
            <div class="side-analytics">
                <div class="metrics-panel rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="w-2 h-2 bg-dt-green rounded-full animate-pulse"></div>
                        <h3 class="text-sm font-semibold text-dt-cyan">üé≤ Analytics</h3>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-xs">üéØ Rolls</span>
                            <span class="metric-value text-sm font-bold" id="totalRolls">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-xs">‚úÖ Wins</span>
                            <span class="metric-value text-sm font-bold" id="totalWins">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-xs">üìä Rate</span>
                            <span class="metric-value text-sm font-bold" id="winRate">0%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-xs">üèÜ Profit</span>
                            <span class="metric-value text-sm font-bold" id="totalProfit">$0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-dt-light-gray text-xs">üî• Streak</span>
                            <span class="metric-value text-sm font-bold" id="currentStreak">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Game Area -->
            <div class="main-game-area h-full">
                <div class="h-full flex">
                    <div class="flex-1 p-6">
                        <div class="h-full flex flex-col justify-center">
                            <!-- Dice Game Table -->
                            <div class="dice-table rounded-3xl p-8 h-full flex flex-col justify-center">
                        
                        <!-- Dice Area -->
                        <div class="text-center mb-8">
                            <h2 class="text-2xl font-bold text-dt-cyan mb-6">üß† Process Intelligence</h2>
                                <p class="text-sm text-dt-light-gray">Advanced Dice Analytics</p>
                            
                            <!-- Process Intelligence Title -->
                            <div class="text-center mb-6">
                                <h2 class="text-2xl font-bold text-dt-cyan mb-2"></h2>
                                <p class="text-sm text-dt-light-gray"></p>
                            </div>
                            
                            <!-- Dice Display -->
                            <div class="dice-container flex justify-center space-x-8 mb-8">
                                <div class="text-center">
                                    <div id="dice1" class="dice mx-auto mb-2">
                                        <div class="dice-cube">
                                            <div class="dice-face front face-1"><div class="dice-dot"></div></div>
                                            <div class="dice-face back face-6">
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            </div>
                                            <div class="dice-face right face-3"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face left face-4"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face top face-2"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face bottom face-5"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div id="dice2" class="dice mx-auto mb-2">
                                        <div class="dice-cube">
                                            <div class="dice-face front face-1"><div class="dice-dot"></div></div>
                                            <div class="dice-face back face-6">
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                                <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            </div>
                                            <div class="dice-face right face-3"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face left face-4"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face top face-2"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                            <div class="dice-face bottom face-5"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sum Display -->
                            <div class="mb-6">
                                <div class="text-4xl font-bold text-dt-yellow mb-2" id="diceSum">2</div>
                                <div class="text-dt-light-gray">Dice Total</div>
                            </div>
                        </div>
                        
                        <!-- Betting Areas -->
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="pass" onclick="placeBet('pass')">
                                <div class="font-bold text-lg text-dt-green">PASS LINE</div>
                                <div class="text-sm text-dt-light-gray">Win on 7 or 11</div>
                                <div class="text-xs text-dt-yellow">Payout: 2:1</div>
                            </div>
                            
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="dont_pass" onclick="placeBet('dont_pass')">
                                <div class="font-bold text-lg text-red-400">DON'T PASS</div>
                                <div class="text-sm text-dt-light-gray">Win on 2 or 3</div>
                                <div class="text-xs text-dt-yellow">Payout: 2:1</div>
                            </div>
                            
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="field" onclick="placeBet('field')">
                                <div class="font-bold text-lg text-dt-blue">FIELD</div>
                                <div class="text-sm text-dt-light-gray">2,3,4,9,10,11,12</div>
                                <div class="text-xs text-dt-yellow">Payout: 2:1</div>
                            </div>
                            
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="snake_eyes" onclick="placeBet('snake_eyes')">
                                <div class="font-bold text-lg text-dt-purple">SNAKE EYES</div>
                                <div class="text-sm text-dt-light-gray">Double 1s</div>
                                <div class="text-xs text-dt-yellow">Payout: 30:1</div>
                            </div>
                            
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="boxcars" onclick="placeBet('boxcars')">
                                <div class="font-bold text-lg text-dt-purple">BOXCARS</div>
                                <div class="text-sm text-dt-light-gray">Double 6s</div>
                                <div class="text-xs text-dt-yellow">Payout: 30:1</div>
                            </div>
                            
                            <div class="bet-area rounded-xl p-4 text-center" data-bet="seven_out" onclick="placeBet('seven_out')">
                                <div class="font-bold text-lg text-dt-cyan">SEVEN OUT</div>
                                <div class="text-sm text-dt-light-gray">Sum equals 7</div>
                                <div class="text-xs text-dt-yellow">Payout: 4:1</div>
                            </div>
                        </div>
                        
                        <!-- Control Panel -->
                        <div class="bg-dt-gray/50 rounded-xl p-6 backdrop-blur-sm border border-dt-orange/20">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                                <div>
                                    <label class="block text-dt-orange font-semibold mb-2">Bet Amount:</label>
                                    <select id="betAmount" class="w-full bg-dt-dark border border-dt-orange/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-dt-orange">
                                        <option value="5">$5</option>
                                        <option value="10" selected>$10</option>
                                        <option value="25">$25</option>
                                        <option value="50">$50</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-dt-orange font-semibold mb-2">Active Bet:</label>
                                    <div id="activeBetDisplay" class="bg-dt-dark border border-dt-orange/30 rounded-lg px-4 py-2 text-dt-light-gray">
                                        None
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-dt-orange font-semibold mb-2">Total Risk:</label>
                                    <div id="totalBetDisplay" class="bg-dt-dark border border-dt-orange/30 rounded-lg px-4 py-2 text-dt-yellow font-mono">
                                        $0
                                    </div>
                                </div>
                                
                                <div class="space-y-2">
                                    <button onclick="clearBets()" class="w-full bg-dt-gray hover:bg-dt-light-gray text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                                        Clear
                                    </button>
                                    <button onclick="rollDice()" id="rollButton" class="w-full bg-gradient-to-r from-dt-orange to-dt-yellow hover:from-dt-yellow hover:to-dt-orange text-white py-2 px-4 rounded-lg font-bold transition-all transform hover:scale-105 active:scale-95">
                                        ROLL DICE
                                    </button>

                                </div>
                            </div>
                        </div>
                        
                        <!-- Result Display -->
                        <div id="resultDisplay" class="text-center mt-6 text-xl font-bold min-h-[2rem]"></div>
                    </div>
                </div>
                
                <!-- Side Panel -->
                <div class="space-y-6">
                    
                    <!-- Probability Chart -->
                    <div class="probability-chart rounded-xl p-4">
                        <h3 class="text-dt-orange font-semibold mb-4">Sum Probabilities</h3>
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">2</div>
                                <div class="text-dt-light-gray">2.8%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">3</div>
                                <div class="text-dt-light-gray">5.6%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">4</div>
                                <div class="text-dt-light-gray">8.3%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">5</div>
                                <div class="text-dt-light-gray">11.1%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">6</div>
                                <div class="text-dt-light-gray">13.9%</div>
                            </div>
                            <div class="sum-indicator bg-dt-orange/50 p-2 rounded text-center">
                                <div class="font-bold">7</div>
                                <div class="text-white">16.7%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">8</div>
                                <div class="text-dt-light-gray">13.9%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">9</div>
                                <div class="text-dt-light-gray">11.1%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">10</div>
                                <div class="text-dt-light-gray">8.3%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">11</div>
                                <div class="text-dt-light-gray">5.6%</div>
                            </div>
                            <div class="sum-indicator bg-dt-gray/50 p-2 rounded text-center">
                                <div class="font-bold">12</div>
                                <div class="text-dt-light-gray">2.8%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Game Stats -->
                    <div class="probability-chart rounded-xl p-4">
                        <h3 class="text-dt-orange font-semibold mb-3">Game Stats</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-dt-light-gray">Rolls:</span>
                                <span id="totalRolls" class="text-dt-cyan font-mono">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-dt-light-gray">Wins:</span>
                                <span id="totalWins" class="text-dt-green font-mono">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-dt-light-gray">Win Rate:</span>
                                <span id="winRate" class="text-dt-yellow font-mono">0%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-dt-light-gray">Total Won:</span>
                                <span id="totalWon" class="text-dt-green font-mono">$0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Rolls -->
                    <div class="probability-chart rounded-xl p-4">
                        <h3 class="text-dt-orange font-semibold mb-3">Recent Rolls</h3>
                        <div id="recentRolls" class="space-y-2 text-xs max-h-32 overflow-y-auto">
                            <div class="text-dt-light-gray text-center">No rolls yet</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
    // Initialize Socket.IO
    const socket = io();
        
        // Check if user has the new required fields, if not populate with defaults
        function ensureUserProfileComplete() {
            const currentUser = localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous';
            const requiredFields = {
                'vegas.customerName': currentUser,
                'vegas.email': 'user@example.com',
                'vegas.companyName': 'Dynatrace',
                'vegas.persona': 'Customer',
                'vegas.booth': 'Business Analytics',
                'vegas.optIn': 'true'
            };
            
            let updated = false;
            for (const [key, defaultValue] of Object.entries(requiredFields)) {
                if (!localStorage.getItem(key)) {
                    localStorage.setItem(key, defaultValue);
                    updated = true;
                }
            }
            
            if (updated) {
                console.log('Auto-populated missing user profile fields with defaults');
            }
        }
        
        // Ensure profile is complete when game loads
        ensureUserProfileComplete();
        
        // Dice-specific cheat methods
        const cheatMethods = {
            diceWeighting: {
                name: 'Weighted Dice Control',
                cost: 140,
                winBoost: 40,
                detectionRisk: 20,
                description: 'Influence dice roll outcomes with weighted mechanics'
            },
            rollPrediction: {
                name: 'Roll Pattern Analysis',
                cost: 110,
                winBoost: 35,
                detectionRisk: 15,
                description: 'AI analysis of dice rolling patterns and physics'
            },
            probabilityManipulation: {
                name: 'Probability Override',
                cost: 190,
                winBoost: 50,
                detectionRisk: 25,
                description: 'Override natural probability distributions'
            },
            streakBooster: {
                name: 'Winning Streak Amplifier',
                cost: 160,
                winBoost: 45,
                detectionRisk: 18,
                description: 'Amplify and extend winning streak probabilities'
            }
        };
        
        // Cheat state management
        let cheatState = {
            active: null,
            winRateBoost: 0,
            detectionRisk: 0
        };
        
        // Side panel toggle for cheat controls
        let sidePanelOpen = false;
        
        function toggleCheatSidePanel() {
            const sidePanel = document.getElementById('cheatSidePanel');
            const mainGameArea = document.getElementById('mainGameArea');
            const toggleBtn = document.getElementById('cheatToggleBtn');
            
            if (!sidePanel) return;
            
            sidePanelOpen = !sidePanelOpen;
            
            if (sidePanelOpen) {
                // Show side panel
                sidePanel.classList.add('side-panel-open');
                if (mainGameArea) mainGameArea.classList.add('main-content-shifted');
                if (toggleBtn) toggleBtn.style.left = '324px'; // 320px panel width + 4px margin
                
                console.log('üéØ Configuration Lab opened');
            } else {
                // Hide side panel
                sidePanel.classList.remove('side-panel-open');
                if (mainGameArea) mainGameArea.classList.remove('main-content-shifted');
                if (toggleBtn) toggleBtn.style.left = '16px'; // Reset to original position
                
                console.log('üéØ Configuration Lab closed');
            }
        }
        
        // Cheat activation functions
        function activateCheat(cheatType) {
            const cheat = cheatMethods[cheatType];
            if (!cheat) return;
            
            cheatState.active = cheatType;
            cheatState.winBoost = cheat.winBoost;
            cheatState.detectionRisk = cheat.detectionRisk;
            
            updateCheatUI();
            showMessage(`üöÄ ${cheat.name} activated! Win boost: +${cheat.winBoost}%`, 'success');
            
            // Auto-deactivate after 30 seconds
            setTimeout(() => {
                if (cheatState.active === cheatType) {
                    deactivateCheat();
                }
            }, 30000);
        }
        
        function deactivateCheat() {
            if (!cheatState.active) return;
            
            cheatState.active = null;
            cheatState.winBoost = 0;
            updateCheatUI();
            showMessage('üîÑ Configuration reset to baseline', 'info');
        }
        
        function updateCheatUI() {
            const buttons = ['cheatDiceWeighting', 'cheatRollPrediction', 'cheatProbabilityManipulation', 'cheatStreakBooster'];
            const types = ['diceWeighting', 'rollPrediction', 'probabilityManipulation', 'streakBooster'];
            
            buttons.forEach((buttonId, index) => {
                const button = document.getElementById(buttonId);
                if (!button) return;
                
                const cheatType = types[index];
                const cheat = cheatMethods[cheatType];
                
                if (cheatState.active === cheatType) {
                    button.classList.add('bg-red-600', 'animate-pulse');
                    button.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span>üî• ACTIVE</span>
                            <span class="text-xs text-red-400">ACTIVE</span>
                        </div>
                        <div class="text-xs text-red-400/70 mt-1">${cheat.name} Running</div>
                    `;
                } else {
                    button.classList.remove('bg-red-600', 'animate-pulse');
                    const icons = ['üé≤', 'üìä', '‚ö°', 'üî•'];
                    button.innerHTML = `
                        <div class="flex items-center justify-between">
                            <span>${icons[index]} ${cheat.name.split(' ')[0]}</span>
                            <span class="text-xs text-green-400">FREE</span>
                        </div>
                        <div class="text-xs text-green-400/70 mt-1">+${cheat.winBoost}% win rate</div>
                    `;
                }
            });
            
            // Update status
            const statusEl = document.getElementById('cheatStatus');
            if (statusEl) {
                if (cheatState.active) {
                    const activeCheat = cheatMethods[cheatState.active];
                    statusEl.innerHTML = `üî• ${activeCheat.name} Active`;
                    statusEl.className = 'text-center text-xs text-red-300 mt-4 pt-4 border-t border-gray-700/50';
                } else {
                    statusEl.innerHTML = 'üî¨ Observatory Mode - Baseline Configuration Active';
                    statusEl.className = 'text-center text-xs text-gray-400 mt-4 pt-4 border-t border-gray-700/50';
                }
            }
            
            // Update side panel status indicators
            const sidePanelCheatStatus = document.getElementById('sidePanelCheatStatus');
            const sidePanelBoostLevel = document.getElementById('sidePanelBoostLevel');
            
            if (sidePanelCheatStatus && sidePanelBoostLevel) {
                if (cheatState.active) {
                    const activeCheat = cheatMethods[cheatState.active];
                    sidePanelCheatStatus.textContent = activeCheat.name;
                    sidePanelCheatStatus.className = 'text-red-400';
                    sidePanelBoostLevel.textContent = `+${activeCheat.winBoost}%`;
                    sidePanelBoostLevel.className = 'text-red-400';
                } else {
                    sidePanelCheatStatus.textContent = 'None';
                    sidePanelCheatStatus.className = 'text-dt-yellow';
                    sidePanelBoostLevel.textContent = 'Baseline';
                    sidePanelBoostLevel.className = 'text-dt-green';
                }
            }
        }

        // Game state
        let isRolling = false;
        let currentBet = null;
        let gameStats = {
            totalRolls: 0,
            totalWins: 0,
            totalWon: 0,
            recentRolls: []
        };
        
        // Dice face patterns
        const diceFaces = {
            1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6
        };
        
        // Test function to cycle through all faces
        function testAllFaces() {
            console.log('üß™ Starting dice face test...');
            let faceValue = 1;
            
            const testInterval = setInterval(() => {
                console.log(`üé≤ Testing face ${faceValue}...`);
                updateDiceFace('dice1', faceValue);
                updateDiceFace('dice2', faceValue);
                
                faceValue++;
                if (faceValue > 6) {
                    clearInterval(testInterval);
                    console.log('‚úÖ Face test complete!');
                }
            }, 2000);
        }
        
        // Call test function from browser console: testAllFaces()
        window.testAllFaces = testAllFaces;
        
        function updateDiceFace(diceId, value) {
            const dice = document.getElementById(diceId);
            if (!dice) {
                console.error(`‚ùå Dice element ${diceId} not found`);
                return;
            }
            
            // Validate dice value
            if (!value || value < 1 || value > 6) {
                console.error(`‚ùå Invalid dice value for ${diceId}: ${value}`);
                return;
            }
            
            console.log(`üé≤ FORCING ${diceId} to show face ${value} using direct replacement`);
            
            // Generate the correct dice face HTML based on value
            const dotConfigs = {
                1: '<div class="dice-dot"></div>',
                2: '<div class="dice-dot"></div><div class="dice-dot"></div>',
                3: '<div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div>',
                4: '<div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div>',
                5: '<div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div>',
                6: '<div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div><div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div><div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>'
            };
            
            // Replace the entire dice content with a single visible face
            dice.innerHTML = `
                <div class="dice-cube">
                    <div class="dice-face front face-${value}" style="transform: translateZ(60px); opacity: 1; visibility: visible; z-index: 10;">
                        ${dotConfigs[value]}
                    </div>
                </div>
            `;
            
            console.log(`‚úÖ ${diceId} REPLACED with face ${value} showing ${dotConfigs[value].split('dice-dot').length - 1} dots`);
            
            // Store the current value for sum calculation
            dice.setAttribute('data-value', value);
            
            // Update sum display
            const dice1Value = parseInt(document.getElementById('dice1').getAttribute('data-value') || 1);
            const dice2Value = parseInt(document.getElementById('dice2').getAttribute('data-value') || 1);
            const sum = dice1Value + dice2Value;
            
            const sumDisplay = document.getElementById('diceSum');
            if (sumDisplay) {
                sumDisplay.textContent = sum;
            }
            
            console.log(`üìä Sum calculated: ${dice1Value} + ${dice2Value} = ${sum}`);
            
            // Highlight the sum on probability chart
            highlightSum(sum);
        }
        
        function placeBet(betType) {
            if (isRolling) return;
            
            console.log(`üéØ Placing bet: ${betType}`);
            
            // Clear previous selection
            document.querySelectorAll('.bet-area').forEach(area => {
                area.classList.remove('selected');
            });
            
            // Select new bet
            const betArea = document.querySelector(`[data-bet="${betType}"]`);
            if (betArea) {
                betArea.classList.add('selected');
            }
            
            currentBet = betType;
            
            const betAmount = parseInt(document.getElementById('betAmount').value);
            const betNames = {
                pass: 'Pass Line',
                dont_pass: "Don't Pass",
                field: 'Field',
                snake_eyes: 'Snake Eyes',
                boxcars: 'Boxcars',
                seven_out: 'Seven Out'
            };
            
            document.getElementById('activeBetDisplay').textContent = betNames[betType] || betType;
            document.getElementById('totalBetDisplay').textContent = `$${betAmount}`;
        }
        
        function clearBets() {
            currentBet = null;
            document.querySelectorAll('.bet-area').forEach(area => {
                area.classList.remove('selected');
            });
            document.getElementById('activeBetDisplay').textContent = 'None';
            document.getElementById('totalBetDisplay').textContent = '$0';
        }
        
        async function rollDice() {
            if (isRolling || !currentBet) {
                if (!currentBet) {
                    showNotification('Please place a bet first!', 'error');
                }
                return;
            }
            
            const betAmount = parseInt(document.getElementById('betAmount').value);
            // balance check will be enforced server-side; optional client check from last known display
            const displayBalance = parseInt((document.getElementById('balanceDisplay').textContent || '0').replace(/[^0-9]/g, '')) || 0;
            if (displayBalance < betAmount) {
                showNotification('üí≥ Insufficient DT Credits!', 'error');
                return;
            }
            
            // Start rolling animation
            isRolling = true;
            document.getElementById('rollButton').disabled = true;
            document.getElementById('rollButton').textContent = 'ROLLING...';
            // Deduct stake immediately (visual) and sync localStorage
            const balanceText = document.getElementById('balanceDisplay').textContent || '$0';
            const preRollBalance = parseInt(balanceText.replace(/[^0-9]/g, ''), 10) || 0;
            const betAmountNum = parseInt(betAmount, 10) || 0;
            const postBetBalance = Math.max(0, preRollBalance - betAmountNum);
            
            console.log(`üîç Balance deduction debug:`);
            console.log(`  - Balance text: "${balanceText}"`);
            console.log(`  - Parsed preRollBalance: ${preRollBalance} (type: ${typeof preRollBalance})`);
            console.log(`  - Bet amount: ${betAmountNum} (type: ${typeof betAmountNum})`);
            console.log(`  - Calculation: ${preRollBalance} - ${betAmountNum} = ${postBetBalance}`);
            
            document.getElementById('balanceDisplay').textContent = `$${postBetBalance}`;
            localStorage.setItem('vegasBalance', String(postBetBalance));
            console.log(`üé≤ Bet placed: Balance ${preRollBalance} -> ${postBetBalance}`);
            
            // Enhanced 3D dice rolling animation - create full cubes for rolling
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            
            // Temporarily replace with full 3D cubes for rolling animation
            dice1.innerHTML = `
                <div class="dice-cube">
                    <div class="dice-face front face-1"><div class="dice-dot"></div></div>
                    <div class="dice-face back face-6">
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    </div>
                    <div class="dice-face right face-3"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face left face-4"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face top face-2"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face bottom face-5"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                </div>
            `;
            dice2.innerHTML = `
                <div class="dice-cube">
                    <div class="dice-face front face-1"><div class="dice-dot"></div></div>
                    <div class="dice-face back face-6">
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                        <div class="face-6-row"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    </div>
                    <div class="dice-face right face-3"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face left face-4"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face top face-2"><div class="dice-dot"></div><div class="dice-dot"></div></div>
                    <div class="dice-face bottom face-5"><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div><div class="dice-dot"></div></div>
                </div>
            `;
            
            const dice1Cube = dice1.querySelector('.dice-cube');
            const dice2Cube = dice2.querySelector('.dice-cube');
            
            dice1.classList.add('rolling');
            dice2.classList.add('rolling');
            
            console.log('üé≤ Starting 3D rolling animation with full cubes...');
            
            // Start dramatic 3D rolling sequence
            gsap.to([dice1, dice2], {
                scale: 1.1,
                duration: 0.2,
                ease: "power2.out"
            });
            
            gsap.to([dice1Cube, dice2Cube], {
                rotationX: 1080 + (Math.random() * 360),
                rotationY: 1080 + (Math.random() * 360), 
                rotationZ: 720 + (Math.random() * 180),
                duration: 1.8,
                ease: "power3.out",
                onComplete: () => {
                    console.log('üé≤ 3D rolling animation complete!');
                }
            });
            
            document.getElementById('resultDisplay').innerHTML = `
                <div class="text-dt-orange animate-pulse">
                    üé≤ Rolling dice... üé≤
                </div>
            `;
            
            try {
                // Apply cheat logic BEFORE rolling - increase probability of favorable outcomes
                let cheatOverride = null;
                if (cheatState.active) {
                    const cheat = cheatMethods[cheatState.active];
                    const cheatRoll = Math.random() * 100;
                    
                    console.log(`üéØ Pre-roll cheat check: ${cheat.name} (${cheat.winBoost}% boost for ${currentBet})`);
                    console.log(`üé≤ Cheat roll: ${cheatRoll.toFixed(1)}% vs ${cheat.winBoost}% threshold`);
                    
                    if (cheatRoll < cheat.winBoost) {
                        console.log(`üöÄ CHEAT ACTIVATED! Forcing favorable dice for ${currentBet}!`);
                        
                        // Generate winning dice combinations for the current bet
                        switch (currentBet) {
                            case 'pass':
                                // Pass Line wins on 7 or 11
                                const passWins = [[1,6], [2,5], [3,4], [4,3], [5,2], [6,1], [5,6], [6,5]]; // 7s and 11s
                                const passChoice = passWins[Math.floor(Math.random() * passWins.length)];
                                cheatOverride = { dice1: passChoice[0], dice2: passChoice[1] };
                                break;
                                
                            case 'dont_pass':
                                // Don't Pass wins on 2 or 3
                                const dontPassWins = [[1,1], [1,2], [2,1]]; // 2s and 3s
                                const dontPassChoice = dontPassWins[Math.floor(Math.random() * dontPassWins.length)];
                                cheatOverride = { dice1: dontPassChoice[0], dice2: dontPassChoice[1] };
                                break;
                                
                            case 'field':
                                // Field wins on 2,3,4,9,10,11,12
                                const fieldWins = [[1,1], [1,2], [2,1], [1,3], [2,2], [3,1], [3,6], [4,5], [5,4], [6,3], [4,6], [5,5], [6,4], [5,6], [6,5], [6,6]];
                                const fieldChoice = fieldWins[Math.floor(Math.random() * fieldWins.length)];
                                cheatOverride = { dice1: fieldChoice[0], dice2: fieldChoice[1] };
                                break;
                                
                            case 'snake_eyes':
                                // Snake Eyes wins on 1+1
                                cheatOverride = { dice1: 1, dice2: 1 };
                                break;
                                
                            case 'boxcars':
                                // Boxcars wins on 6+6
                                cheatOverride = { dice1: 6, dice2: 6 };
                                break;
                                
                            case 'seven_out':
                                // Seven Out wins on sum = 7
                                const sevenWins = [[1,6], [2,5], [3,4], [4,3], [5,2], [6,1]];
                                const sevenChoice = sevenWins[Math.floor(Math.random() * sevenWins.length)];
                                cheatOverride = { dice1: sevenChoice[0], dice2: sevenChoice[1] };
                                break;
                        }
                        
                        if (cheatOverride) {
                            console.log(`üé≤ Cheat forcing dice to: ${cheatOverride.dice1} + ${cheatOverride.dice2} = ${cheatOverride.dice1 + cheatOverride.dice2}`);
                            
                            // Show enhanced visual cheat activation message
                            const cheatMsg = document.createElement('div');
                            cheatMsg.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50';
                            const betName = currentBet.replace('_', ' ').toUpperCase();
                            cheatMsg.innerHTML = `
                                <div class="bg-gradient-to-r from-purple-900/95 to-purple-700/95 backdrop-blur-lg border-2 border-purple-400 rounded-xl p-6 shadow-2xl animate-bounce">
                                    <div class="text-center">
                                        <div class="text-4xl mb-2">üéØ</div>
                                        <div class="text-2xl font-bold text-purple-200 mb-1">${cheat.name}</div>
                                        <div class="text-lg text-purple-300 mb-2">ACTIVATED!</div>
                                        <div class="text-sm text-purple-100 bg-purple-800/50 rounded-lg px-3 py-1">
                                            Forcing ${betName} Win!
                                        </div>
                                    </div>
                                </div>
                            `;
                            document.body.appendChild(cheatMsg);
                            
                            // Fade out animation
                            setTimeout(() => {
                                cheatMsg.style.transition = 'opacity 1s ease-out';
                                cheatMsg.style.opacity = '0';
                                setTimeout(() => cheatMsg.remove(), 1000);
                            }, 3000);
                        }
                    }
                }
                
                // Make API call (server handles balance debit/credit and returns newBalance)
                const response = await fetch('/api/dice/roll', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        Game: 'Vegas Dice',
                        BetAmount: betAmount,
                        Username: localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous',
                        CustomerName: localStorage.getItem('vegas.customerName') || localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous',
                        Email: localStorage.getItem('vegas.email') || '',
                        CompanyName: localStorage.getItem('vegas.companyName') || '',
                        Persona: localStorage.getItem('vegas.persona') || '',
                        Booth: localStorage.getItem('vegas.booth') || '',
                        OptIn: localStorage.getItem('vegas.optIn') === 'true',
                        WinFlag: null,
                        WinningAmount: 0,
                        LossAmount: 0,
                        Balance: parseInt(localStorage.getItem('vegasBalance') || '0'),
                        Timestamp: new Date().toISOString(),
                        Action: 'Roll',
                        Device: 'Browser-UI',
                        CorrelationId: `sim_${Date.now()}_${Math.floor(Math.random()*1e9)}`,
                        ResultIcons: [],
                        Status: 'Started',
                        ErrorType: null,
                        ErrorMessage: null,
                        StatusCode: 0,
                        // game-specific
                        BetType: currentBet,
                        // cheat system
                        CheatActive: cheatState.active !== null,
                        CheatType: cheatState.active,
                        CheatDetails: cheatState.active ? cheatMethods[cheatState.active] : null,
                        // If cheat override was determined, send the calculated payout
                        CheatPayout: cheatOverride ? (betAmount * (currentBet === 'snake_eyes' || currentBet === 'boxcars' ? 30 : currentBet === 'seven_out' ? 4 : 2)) : null,
                        // Override dice if cheat is forcing specific values
                        CheatOverride: cheatOverride
                    })
                });
                
                const data = await response.json();
                console.log(`üì° Server response:`, data);
                
                // Verify server returned valid dice values
                if (!data.dice1 || !data.dice2) {
                    console.error(`‚ùå Server did not return dice values:`, data);
                    throw new Error('Invalid server response - missing dice values');
                }
                
                // If cheat was activated, override the server's dice values
                if (cheatOverride) {
                    console.log(`üé≤ Applying cheat override: ${cheatOverride.dice1} + ${cheatOverride.dice2}`);
                    data.dice1 = cheatOverride.dice1;
                    data.dice2 = cheatOverride.dice2;
                    data.sum = cheatOverride.dice1 + cheatOverride.dice2;
                    
                    // Recalculate win status and payout with cheat dice values
                    data.win = true; // Should always win with cheat
                    switch (currentBet) {
                        case 'pass':
                            data.payout = betAmount * 2;
                            break;
                        case 'dont_pass':
                            data.payout = betAmount * 2;
                            break;
                        case 'field':
                            data.payout = betAmount * 2;
                            break;
                        case 'snake_eyes':
                            data.payout = betAmount * 30;
                            break;
                        case 'boxcars':
                            data.payout = betAmount * 30;
                            break;
                        case 'seven_out':
                            data.payout = betAmount * 4;
                            break;
                        default:
                            data.payout = betAmount * 2;
                    }
                    
                    console.log(`üí∞ Cheat payout: $${data.payout} for ${currentBet}`);
                }
                
                // Always prefer server balance - server is the source of truth
                let pendingNewBalance = (typeof data.newBalance === 'number') ? data.newBalance : null;
                
                console.log(`‚öñÔ∏è Balance source decision: server newBalance = ${data.newBalance}, cheat active = ${!!cheatOverride}`);
                
                // Only use local calculation if server doesn't provide newBalance (fallback)
                if (pendingNewBalance === null) {
                    console.log(`‚ö†Ô∏è Server didn't provide newBalance, using fallback calculation`);
                    const currentDisplayBalance = parseInt((document.getElementById('balanceDisplay').textContent || '0').replace(/[^0-9]/g, '')) || 0;
                    if (cheatOverride && data.win) {
                        pendingNewBalance = currentDisplayBalance + data.payout;
                        console.log(`üéØ Cheat fallback: ${currentDisplayBalance} + ${data.payout} = ${pendingNewBalance}`);
                    }
                } else {
                    console.log(`‚úÖ Using server balance: ${pendingNewBalance}`);
                }
                
                console.log(`üîç Server response data:`, data);
                console.log(`üîç newBalance from server: ${data.newBalance}, final pendingNewBalance: ${pendingNewBalance}, cheatOverride: ${!!cheatOverride}`);
                
                // Wait for rolling animation
                setTimeout(() => {
                    // Stop rolling animation
                    if (dice1) dice1.classList.remove('rolling');
                    if (dice2) dice2.classList.remove('rolling');
                    
                    // Reset to flat position first
                    const dice1Cube = dice1?.querySelector('.dice-cube');
                    const dice2Cube = dice2?.querySelector('.dice-cube');
                    if (dice1Cube) gsap.set(dice1Cube, { rotationX: 0, rotationY: 0, rotationZ: 0 });
                    if (dice2Cube) gsap.set(dice2Cube, { rotationX: 0, rotationY: 0, rotationZ: 0 });
                    
                    // Add settling bounce effect
                    if (dice1 && dice2) {
                        gsap.to([dice1, dice2], {
                            scale: 1,
                            duration: 0.3,
                            ease: "bounce.out"
                        });
                    }
                    
                    // Update dice faces to show correct values (flat landing)
                    console.log(`üé≤ Server returned: dice1=${data.dice1}, dice2=${data.dice2}, sum=${data.sum}`);
                    console.log(`üéØ About to update dice faces...`);
                    
                    // Verify we have valid dice values
                    if (!data.dice1 || !data.dice2 || data.dice1 < 1 || data.dice1 > 6 || data.dice2 < 1 || data.dice2 > 6) {
                        console.error(`‚ùå Invalid dice values from server: ${data.dice1}, ${data.dice2}`);
                        return;
                    }
                    
                    updateDiceFace('dice1', data.dice1);
                    updateDiceFace('dice2', data.dice2);
                    
                    // Update sum display
                    document.getElementById('diceSum').textContent = data.sum;
                    
                    // Highlight sum in probability chart
                    highlightSum(data.sum);
                    
                    // Verify dice match the payout logic
                    console.log(`üé∞ Payout evaluation: Bet=${currentBet}, Dice=${data.dice1}+${data.dice2}=${data.sum}, Win=${data.win}, Payout=$${data.payout}`);
                    
                    // Show result with payout details
                    showResult(data, betAmount);
                    updateGameStats(data, betAmount);
                    // Emit Completed BizEvent
                    try {
                        const completedEvent = {
                            Game: 'Vegas Dice',
                            BetAmount: betAmount,
                            Username: localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous',
                            CustomerName: localStorage.getItem('vegas.customerName') || localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous',
                            Email: localStorage.getItem('vegas.email') || '',
                            CompanyName: localStorage.getItem('vegas.companyName') || '',
                            Persona: localStorage.getItem('vegas.persona') || '',
                            Booth: localStorage.getItem('vegas.booth') || '',
                            OptIn: localStorage.getItem('vegas.optIn') === 'true',
                            WinFlag: data.win ? 1 : 0,
                            WinningAmount: data.payout || 0,
                            LossAmount: data.win ? 0 : betAmount,
                            Balance: parseInt((document.getElementById('balanceDisplay').textContent || '0').replace(/[^0-9]/g,'')) || 0,
                            Timestamp: new Date().toISOString(),
                            Action: 'RollCompleted',
                            Device: 'Browser-UI',
                            CorrelationId: data.correlationId || `sim_${Date.now()}`,
                            ResultIcons: [String(data.dice1), String(data.dice2)],
                            Status: 'Completed',
                            ErrorType: null,
                            ErrorMessage: null,
                            StatusCode: 200,
                            // game-specific data
                            BetType: currentBet
                        };
                        fetch('/api/bizevent', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(completedEvent) });
                    } catch {}
                    
                    // Update balance - always use server newBalance if available
                    if (pendingNewBalance !== null) {
                        console.log(`üí∞ Using server balance: ${pendingNewBalance}`);
                        localStorage.setItem('vegasBalance', String(pendingNewBalance));
                        document.getElementById('balanceDisplay').textContent = `$${pendingNewBalance}`;
                    } else {
                        console.log(`‚ö†Ô∏è Server newBalance is null, using fallback calculation`);
                        // Fallback: calculate balance locally if server doesn't provide newBalance
                        // Use the current displayed balance (which already has bet deducted)
                        const currentDisplayBalance = parseInt((document.getElementById('balanceDisplay').textContent || '0').replace(/[^0-9]/g, '')) || 0;
                        // If win: current balance + payout (payout already includes the bet amount in most cases)
                        // If loss: current balance stays the same (bet already deducted)
                        const newBalance = data.win ? currentDisplayBalance + data.payout : currentDisplayBalance;
                        localStorage.setItem('vegasBalance', String(newBalance));
                        document.getElementById('balanceDisplay').textContent = `$${newBalance}`;
                        console.log(`üí∞ Fallback balance update: ${currentDisplayBalance} -> ${newBalance} (win: ${data.win}, payout: ${data.payout}, bet: ${betAmount})`);
                    }
                    // Show "COMPLETE" immediately after dice land
                    document.getElementById('rollButton').textContent = 'COMPLETE';
                    
                    // Reset for next roll (but keep bet selection) after 2 seconds
                    setTimeout(() => {
                        // Don't clear bets - keep the last selection active
                        // clearBets();
                        isRolling = false;
                        document.getElementById('rollButton').disabled = false;
                        document.getElementById('rollButton').textContent = 'ROLL DICE';
                    }, 3000);
                }, 1000);
                
            } catch (error) {
                console.error('Roll error:', error);
                showNotification('Roll failed! Try again.', 'error');
                // Refund stake on error
                document.getElementById('balanceDisplay').textContent = `$${preRollBalance}`;
                
                if (dice1) dice1.classList.remove('rolling');
                if (dice2) dice2.classList.remove('rolling');
                
                // Reset scale on error
                if (dice1 && dice2) {
                    gsap.set([dice1, dice2], { scale: 1 });
                }
                
                isRolling = false;
                document.getElementById('rollButton').disabled = false;
                document.getElementById('rollButton').textContent = 'ROLL DICE';
            }
        }
        
        function highlightSum(sum) {
            // Remove previous highlights
            document.querySelectorAll('.sum-indicator').forEach(indicator => {
                indicator.classList.remove('highlight');
            });
            
            // Highlight current sum
            const sumIndicators = document.querySelectorAll('.sum-indicator');
            const targetIndicator = Array.from(sumIndicators).find(indicator => {
                const value = parseInt(indicator.querySelector('div').textContent);
                return value === sum;
            });
            
            if (targetIndicator) {
                targetIndicator.classList.add('highlight');
                
                setTimeout(() => {
                    targetIndicator.classList.remove('highlight');
                }, 3000);
            }
        }
        
        function showResult(data, betAmount) {
            const resultDiv = document.getElementById('resultDisplay');
            
            console.log(`üé≤ Result: ${data.dice1}+${data.dice2}=${data.sum}, Bet: ${data.betType}, Win: ${data.win}, Payout: $${data.payout}`);
            
            if (data.win) {
                resultDiv.innerHTML = `
                    <div class="text-dt-green">
                        üéâ WIN! Rolled ${data.dice1} and ${data.dice2} (Sum: ${data.sum})
                        <br>
                        <span class="text-lg">Bet: ${data.betType} - Payout: ${data.payoutMultiplier}:1</span>
                        <br>
                        <span class="text-2xl">+$${data.payout}</span>
                    </div>
                `;
                
                // Show payout animation
                const payoutText = document.createElement('div');
                payoutText.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl font-bold text-dt-yellow z-50 animate-bounce';
                payoutText.textContent = `+$${data.payout}`;
                document.body.appendChild(payoutText);
                
                setTimeout(() => {
                    payoutText.remove();
                }, 2000);
                
            } else {
                const betNames = {
                    pass: 'Pass Line',
                    dont_pass: "Don't Pass",
                    field: 'Field',
                    snake_eyes: 'Snake Eyes (1+1)',
                    boxcars: 'Boxcars (6+6)',
                    seven_out: 'Seven Out (sum=7)'
                };
                const betName = betNames[data.betType] || data.betType;
                
                resultDiv.innerHTML = `
                    <div class="text-dt-light-gray">
                        üòî ${betName} loses
                        <br>
                        Rolled ${data.dice1} and ${data.dice2} (Sum: ${data.sum})
                        <br>
                        <span class="text-sm text-dt-yellow">Try a different bet type!</span>
                    </div>
                `;
            }
            
            // Clear result after delay
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 5000);
        }
        
        function updateGameStats(data, betAmount) {
            gameStats.totalRolls++;
            if (data.win) {
                gameStats.totalWins++;
                gameStats.totalWon += data.payout;
            }
            
            // Log cheat effectiveness
            if (cheatState.active) {
                const winRate = gameStats.totalRolls > 0 ? (gameStats.totalWins / gameStats.totalRolls) * 100 : 0;
                console.log(`üìä Current win rate with ${cheatMethods[cheatState.active].name}: ${winRate.toFixed(1)}%`);
            }
            
            // Add to recent rolls
            gameStats.recentRolls.unshift({
                dice1: data.dice1,
                dice2: data.dice2,
                sum: data.sum,
                bet: currentBet,
                betAmount: betAmount,
                win: data.win,
                payout: data.payout || 0,
                cheatUsed: cheatState.active,
                timestamp: Date.now()
            });
            
            // Keep only last 10 rolls
            if (gameStats.recentRolls.length > 10) {
                gameStats.recentRolls = gameStats.recentRolls.slice(0, 10);
            }
            
            updateStatsDisplay();
            updateRecentRollsDisplay();
            
            // Emit game action
            socket.emit('game-action', {
                game: 'dice',
                action: 'roll',
                betAmount: betAmount,
                win: data.win,
                winAmount: data.payout || 0,
                result: [data.dice1, data.dice2]
            });
        }
        
        function updateStatsDisplay() {
            document.getElementById('totalRolls').textContent = gameStats.totalRolls;
            document.getElementById('totalWins').textContent = gameStats.totalWins;
            document.getElementById('totalWon').textContent = `$${gameStats.totalWon}`;
            
            const winRate = gameStats.totalRolls > 0 ? 
                ((gameStats.totalWins / gameStats.totalRolls) * 100).toFixed(1) : 0;
            document.getElementById('winRate').textContent = `${winRate}%`;
        }
        
        function updateRecentRollsDisplay() {
            const container = document.getElementById('recentRolls');
            container.innerHTML = '';
            
            if (gameStats.recentRolls.length === 0) {
                container.innerHTML = '<div class="text-dt-light-gray text-center">No rolls yet</div>';
                return;
            }
            
            gameStats.recentRolls.forEach(roll => {
                const rollDiv = document.createElement('div');
                rollDiv.className = 'flex justify-between items-center p-2 bg-dt-darker rounded border border-dt-gray/30';
                rollDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="text-xs bg-dt-gray px-2 py-1 rounded">${roll.dice1}</div>
                        <div class="text-xs bg-dt-gray px-2 py-1 rounded">${roll.dice2}</div>
                        <div class="text-xs text-dt-light-gray">= ${roll.sum}</div>
                    </div>
                    <div class="text-right text-xs">
                        <div class="text-dt-light-gray">$${roll.betAmount}</div>
                        <div class="${roll.win ? 'text-dt-green' : 'text-dt-light-gray'}">
                            ${roll.win ? `+$${roll.payout}` : '-'}
                        </div>
                    </div>
                `;
                container.appendChild(rollDiv);
            });
        }
        
        async function addFunds() {
            const username = localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Anonymous';
            try {
                const resp = await fetch('/api/user/topup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ Username: username, Amount: 500 })
                });
                const data = await resp.json();
                if (typeof data.balance === 'number') {
                    localStorage.setItem('vegasBalance', String(data.balance));
                    updateBalanceDisplay();
                    showNotification('üí∞ $500 added to your balance!', 'success');
                } else {
                    showNotification('Top-up failed to persist.', 'error');
                }
            } catch (e) {
                showNotification('Top-up request failed.', 'error');
            }
        }
        
        function updateBalance(change) {
            const currentBalance = parseInt(localStorage.getItem('vegasBalance') || '0');
            const newBalance = Math.max(0, currentBalance + change);
            localStorage.setItem('vegasBalance', newBalance);
            updateBalanceDisplay();
        }
        
        function updateBalanceDisplay() {
            const balance = localStorage.getItem('vegasBalance') || '0';
            document.getElementById('balanceDisplay').textContent = `$${balance}`;
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-6 right-6 z-50 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-dt-green text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-dt-blue text-white'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            gsap.from(notification, {
                duration: 0.3,
                x: 100,
                opacity: 0,
                ease: "back.out(1.7)"
            });
            
            // Auto remove
            setTimeout(() => {
                gsap.to(notification, {
                    duration: 0.3,
                    x: 100,
                    opacity: 0,
                    ease: "back.in(1.7)",
                    onComplete: () => notification.remove()
                });
            }, 3000);
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            const username = localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Agent';
            document.getElementById('agentName').textContent = username;
            
            // Sync balance with server
            try {
                const resp = await fetch('/api/user/init', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ Username: username })
                });
                const u = await resp.json();
                if (typeof u.balance === 'number') {
                    localStorage.setItem('vegasBalance', String(u.balance));
                    document.getElementById('balanceDisplay').textContent = `$${u.balance}`;
                } else {
                    updateBalanceDisplay();
                }
            } catch (e) {
                updateBalanceDisplay();
            }
            
            // Initialize dice with random values - add delay to ensure DOM is ready
            setTimeout(() => {
                console.log('Initializing dice...');
                
                // Initialize cubes to show face 1 by default
                const dice1Cube = document.querySelector('#dice1 .dice-cube');
                const dice2Cube = document.querySelector('#dice2 .dice-cube');
                
                if (dice1Cube) {
                    gsap.set(dice1Cube, { rotationX: 0, rotationY: 0 });
                }
                if (dice2Cube) {
                    gsap.set(dice2Cube, { rotationX: 0, rotationY: 0 });
                }
                
                // Test with different values using direct face rendering
                const initialDice1 = 2;  // Should show 2 dots
                const initialDice2 = 5;  // Should show 5 dots
                
                console.log(`üß™ DIRECT RENDERING TEST: ${initialDice1} dots and ${initialDice2} dots`);
                
                // Set initial data values
                let dice1El = document.getElementById('dice1');
                let dice2El = document.getElementById('dice2');
                if (dice1El) dice1El.setAttribute('data-value', initialDice1);
                if (dice2El) dice2El.setAttribute('data-value', initialDice2);
                
                // Now update to show the correct faces
                updateDiceFace('dice1', initialDice1);
                updateDiceFace('dice2', initialDice2);
                
                // Ensure dice are visible
                const dice1 = document.getElementById('dice1');
                const dice2 = document.getElementById('dice2');
                if (dice1) dice1.style.visibility = 'visible';
                if (dice2) dice2.style.visibility = 'visible';
            }, 100);
            
            // Animate page entrance
            gsap.from('.dice-table', {
                duration: 1,
                scale: 0.9,
                opacity: 0,
                ease: "back.out(1.7)"
            });
            
            gsap.from('.dice', {
                duration: 0.8,
                y: -50,
                rotation: 180,
                opacity: 0,
                stagger: 0.2,
                ease: "bounce.out",
                delay: 0.5,
                onComplete: () => {
                    // Ensure dice are fully visible and properly positioned after animation
                    console.log('Dice animation complete, ensuring proper positioning...');
                    
                    // Use GSAP to set final values to ensure proper positioning
                    gsap.set('.dice', {
                        opacity: 1,
                        visibility: 'visible',
                        y: 0,
                        rotation: 0,
                        scale: 1,
                        clearProps: 'transform'
                    });
                    
                    // Double-check individual dice elements
                    const dice1 = document.getElementById('dice1');
                    const dice2 = document.getElementById('dice2');
                    if (dice1) dice1.style.visibility = 'visible';
                    if (dice2) dice2.style.visibility = 'visible';
                }
            });
        });

        // Add funds function for deposit button
        function addFunds() {
            const currentBalance = parseInt(localStorage.getItem('vegasBalance') || '1000');
            const newBalance = currentBalance + 1000;
            localStorage.setItem('vegasBalance', String(newBalance));
            
            updateBalanceDisplay();
            console.log(`üí∞ Added $1000 credits! New balance: $${newBalance}`);
        }

        // Update balance display with $ currency
        function updateBalanceDisplay() {
            const balance = localStorage.getItem('vegasBalance') || '1000';
            const balanceElement = document.getElementById('balanceDisplay');
            if (balanceElement) {
                balanceElement.textContent = `$${balance}`;
            }
        }

        // Initialize user info
        document.addEventListener('DOMContentLoaded', function() {
            const username = localStorage.getItem('vegas.username') || localStorage.getItem('vegasUser') || 'Agent';
            const agentNameElement = document.getElementById('agentName');
            if (agentNameElement) {
                agentNameElement.textContent = username;
            }
            updateBalanceDisplay();
        });
        
        // Socket event handlers
        socket.on('connect', () => {
            console.log('üîå Connected to dice game');
        });
    </script>
</body>
</html>